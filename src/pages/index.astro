---
import BaseLayout from '../layouts/BaseLayout.astro';

const postFiles = import.meta.glob('./posts/*.mdx', { eager: true });
const posts = Object.entries(postFiles).map(([path, post]: [string, any]) => ({
  url: path.replace('./posts/', '/posts/').replace('.mdx', ''),
  frontmatter: post.frontmatter
})).sort(
  (a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf()
);

// Get unique categories
const categories = [...new Set(posts.map(post => post.frontmatter.category).filter(Boolean))].sort();
---

<BaseLayout title="designcode.me" description="Thoughts and Ramblings">
  {categories.length > 0 && (
    <div class="category-filter">
      <button class="category-btn active" data-category="all">All</button>
      {categories.map(category => (
        <button class="category-btn" data-category={category}>{category}</button>
      ))}
    </div>
  )}

  <div class="posts-list">
    {posts.map(post => {
      const isExternal = !!post.frontmatter.externalUrl;
      const linkUrl = isExternal ? post.frontmatter.externalUrl : post.url;
      const linkProps = isExternal ? { target: '_blank', rel: 'noopener noreferrer' } : {};

      return (
        <article class="post-item" data-category={post.frontmatter.category || 'uncategorized'}>
          <h2 class="post-title">
            <a href={linkUrl} class="post-link" {...linkProps}>
              {post.frontmatter.title}
              {isExternal && ' â†’'}
            </a>
          </h2>
          <div class="post-meta">
            <p class="post-date">
              {new Date(post.frontmatter.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </p>
            {post.frontmatter.category && (
              <span class="post-category">{post.frontmatter.category}</span>
            )}
          </div>
          <p class="post-description">
            {post.frontmatter.description}
          </p>
        </article>
      );
    })}
  </div>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const categoryButtons = document.querySelectorAll('.category-btn');
    const posts = document.querySelectorAll('.post-item');

    categoryButtons.forEach(button => {
      button.addEventListener('click', () => {
        const selectedCategory = button.dataset.category;

        // Update active state
        categoryButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        // Filter posts
        posts.forEach(post => {
          const postCategory = post.dataset.category;
          if (selectedCategory === 'all' || postCategory === selectedCategory) {
            post.style.display = '';
          } else {
            post.style.display = 'none';
          }
        });
      });
    });
  });
</script>
